package game.entity;


import java.awt.Point;
import java.awt.Rectangle;
import java.awt.geom.Line2D;

import javax.sound.sampled.Line;

import game.render.textures.Texture;
import game.world.TileMap;

public abstract class Mob extends Entity { //It means MOBile entity

	protected double motionX;
	protected double motionY;
	protected double gravity;
	protected double maxMotionY;
	protected boolean isAirBorne;
	protected int pushForceY;
	public int tickerAir;
	protected boolean moving;
	protected double lastMoveY;
	protected Rectangle AABB;
	//public ActionState state;
	public boolean hasCollision = true;
	public boolean falling;
	public double ysp;
	
	public Line2D floorCheck1;
	public Line2D floorCheck2;
	public Line2D centerLine;
	
	public Point center;
	
	public double angle = 0;
	
	public double gsp;
	
	public double xsp;
	
	public int jumpTimer;
	
	public double staticJumpAngle;
	
	public double jumpVelocityY;
	
	public double jumpY;
	public double jumpX;
	
	
	public Mob(Texture texture, double x, double y, TileMap tileMap, Rectangle AABB) {
		super(texture, x, y, tileMap, AABB);
		gravity = 0.5;
		maxMotionY = 10;
		tickerAir = 0;
		this.AABB = AABB;
		
		center = new Point((int)(x+32),(int)(y+32));
		
		floorCheck1 = new Line2D.Float((float)center.getX() + 14, (float)center.getY(), (float)center.getX() + 14, (float)center.getY() + 42);
		floorCheck2 = new Line2D.Float((float)center.getX() - 14, (float)center.getY(), (float)center.getX() - 14, (float)center.getY() + 42);
		centerLine = new Line2D.Float((float)center.getX() - 26, (float)center.getY() + 6, (float)center.getX() + 26, (float)center.getY() + 6);
	}
	
	public void updateLines(double x, double y) {
		center.setLocation((int)(x+32),(int)(y+32));
		
		floorCheck1.setLine((float)center.getX() + 14, (float)center.getY(), (float)center.getX() + 14, (float)center.getY() + 42);
		floorCheck2.setLine((float)center.getX() - 14, (float)center.getY(), (float)center.getX() - 14, (float)center.getY() + 42);
		centerLine.setLine((float)center.getX() - 26, (float)center.getY() + 6, (float)center.getX() + 26, (float)center.getY() + 6);
	}
	
	public abstract void setDead();
	
	@Override
	public void tick() {
		
		if(falling) {
			angle = 0;
		}
		
		jumpTimer--;
		if(jumpTimer <= 0) {
			jumpTimer = 0;
			staticJumpAngle = 0;
		}
		
/*		if(getMotionY() == 0) {
			this.state = ActionState.ON_TILE;
		} else {
			if (motionY > 0) {
				this.state = ActionState.FALLING;
			} else {
				this.state = ActionState.JUMPING;
			}
		}*/
		
		if(motionY != 0) {
			this.isAirBorne = true;
		} else {
			this.isAirBorne = false;
		}
		
		//fall();
		move();
/*		if (motionX != 0) {
			moving = true;
		} else {
			moving = false;
		}*/

		if(y > TileMap.convertToPixels(this.tileMap.getHeight())) {
			this.setDead();
		}
		
	}
	
	public void move() {

		xsp = gsp*Math.cos(angle);
		ysp = -gsp*Math.sin(angle);
		if(jumpTimer > 0) {
		    jumpY = (jumpVelocityY*jumpTimer / 2.2)*Math.cos(staticJumpAngle) + gsp*Math.sin(angle);
			jumpX = (jumpVelocityY*jumpTimer / 2.2)*Math.sin(staticJumpAngle) - gsp*Math.cos(angle);
			ysp -= jumpY;
			xsp -= jumpX;
			//jumpX -= gsp*Math.cos(angle);
			//jumpY -= -gsp*Math.sin(angle);
			
		} else {
			jumpX = 0;
			jumpY = 0;
			fall();
		}
		if(falling) {
			ysp += gravity;
		} else {
			fall();
		}
		//motionX += xsp;
		//motionY += ysp;
		tileMap.entityCollision(x,y,motionX,motionY,this);
		y+=  ysp;
		//y+= gravityY;
		x+=  xsp;
		updateLines(x, y);
		//motionX -= xsp;
		//motionY -= ysp;
	}
	
	
	protected void fall() {
		if (falling) {
			gravity *= 2;
			//motionY += gravity;
			if (gravity > maxMotionY) {
				gravity = maxMotionY;
			} 
		} else {
			gravity = 0.5;
		}
	}
	
	protected void jump(int timerY, double velocityY) {
		
		jumpTimer = timerY;
		staticJumpAngle = angle;
		jumpVelocityY = velocityY;
		
		
	    //jumpY = (jumpVelocityY)*Math.cos(staticJumpAngle);
		//jumpX = (jumpVelocityY)*Math.sin(staticJumpAngle);
		
		
		isAirBorne = true;
		falling = true;
	}
	
	public void setMotionY(double motionY) {
		this.motionY = motionY;
	}
	
	public void setMotionX(double motionX) {
		this.motionX = motionX;
	}
	
	public void setAirBorne(boolean airBorne) {
		this.isAirBorne = airBorne;
	}

	public boolean isAirBorne() {
		return isAirBorne;
	}

	public double getMotionY() {
		return motionY;
	}
	
	public double getMotionX() {
		return motionX;
	}
	
	public boolean isMovingLeft() {
		return gsp < 0;
	}
	
	public boolean isMovingRight() {
		return gsp > 0;
	}
	
	public boolean isMoving() {
		return moving;
	}
	
	public void setMoving(boolean moving) {
		//System.out.println(moving);
		this.moving = moving;
	}
	
}
